<!DOCTYPE html>
<html>

<head>
    <?!= include("css"); ?>
    <base target="_top">
</head>

<body>
    <div id="pair">
        <div id="mypage">
            <font size="5">マイページ</font>
        </div>
        <div id="myname">
            <font size="3"><?= userName ?></font>
        </div>
    </div>
    <table id="mypage_table">
        <tr>
            <th>日時</th>
            <th>内容</th>
            <th>申込状況</th>
        </tr>
        <? for(var i = 0;i < eventDataArray.length;i++){ ?>
        <tr>
            <td><?= eventDataArray[i][2] ?></td>
            <td><a href="https://script.google.com/a/esm.co.jp/macros/s/AKfycby8bHPUrCKgCf7uQm0wj2jlz15LVEz3-FXlXAo46Q/dev?page=eventDetails&eventNumber=<?= i ?>&userId=<?= userId ?>"><?= eventDataArray[i][1] ?></a></td>
            <td><input id="<?= i ?>" class="button" type="button" value="申込">
                <input id="cancel<?= i ?>" class="button" type="button" value="取り消し">
            </td>
        </tr>
        <? } ?>
    </table>
    <button type="button" name="back" onclick="jump('login')" value="back">
        <font size="2">戻る</font>
    </button>
</body>
<script>
    //ページ読み込み時に実行する
    addEventListener('load', function () { client_getEventId() });


    //userIdからイベントIdを取得する関数
    function client_getEventId() {
        //userIdを取得する
        const userId = document.getElementById("myid").outerHTML;
        //  alert("userid=" + userId);
        google.script.run
            .withSuccessHandler(client_getEventInfo)
            .withFailureHandler(onFailure)
            .getEventId(userId);
    }
    // イベントの詳細情報を取得する
    function client_getEventInfo(eventId) {
        //  alert("eventId=" + eventId);
        google.script.run
            .withSuccessHandler(createTableRow)
            .withFailureHandler(onFailure)
            .withUserObject(eventId)
            .getEventInfo();
    }

    // 画面に遷移する
    function jump(screenName) {
        google.script.run
            .withSuccessHandler(createUrl)
            .withUserObject(screenName)
            .getAppUrl();
    }

    //サーバ側のgetAppUrl()の失敗時に実行する
    function onFailure(error) {
        alert(error.message);
    }

    //サーバ側のgetAppUrl()の成功時に実行する
    function createUrl(url, screenName) {
        window.top.location.href = url + "?page=" + screenName;
    }

</script>

</html>

<!DOCTYPE html>
<html>

<head>
    <?!= include("css"); ?>
    <base target="_top">
</head>

<body>
    <div id="pair">
        <div id="mypage">
            <font size="5">マイページ</font>
        </div>
        <div id="myname">
            <font size="3"><?= getData(mydata[0]) ?></font>
        </div>
    </div>
    <div id="maintable"></div>
    <button type="button" name="back" onclick="jump('login')" value="back">
        <font size="2">戻る</font>
    </button>
</body>
<script>
    //ページ読み込み時に実行する
    addEventListener('load', function () { client_getEventInfo() });

    // イベントの詳細情報を取得する
    function client_getEventInfo() {
        google.script.run
            .withSuccessHandler(createTableRow)
            .withFailureHandler(onFailure)
            .getEventInfo();
    }

    // テーブルを作成する
    function createTableRow(eventDataArray) {
        const table = document.createElement("table");
        table.setAttribute("id", "mypage_table");
        for (let i = 0; i < eventDataArray.length; i++) {
            if (i === 0) {
                let tr = document.createElement("tr");
                for (let j = 1; j < 3; j++) {
                    let td = document.createElement("td");
                    td.setAttribute("id", "mypage_td");
                    td.textContent = eventDataArray[i][j];
                    tr.appendChild(td);
                }
                let td = document.createElement("td");
                td.textContent = "申込状況";
                td.setAttribute("id", "mypage_td");
                tr.appendChild(td);
                table.appendChild(tr);
            } else {
                let tr = document.createElement("tr");
                for (let j = 1; j < 3; j++) {
                    let td = document.createElement("td");
                    td.setAttribute("id", "mypage_td");
                    td.textContent = eventDataArray[i][j];
                    tr.appendChild(td);
                }
                let td = document.createElement("td");
                td.setAttribute("id", "mypage_td");
                let button = document.createElement("input");
                button.type = "button";
                button.value = "申込";
                let cloneButton = button.cloneNode(true);
                cloneButton.value = "キャンセル";
                td.appendChild(button);
                td.appendChild(cloneButton);
                tr.appendChild(td);
                table.appendChild(tr);
            }
        }
        document.getElementById("maintable").appendChild(table);
    }

    // 画面に遷移する
    function jump(screenName) {
        google.script.run
            .withSuccessHandler(createUrl)
            .withUserObject(screenName)
            .getAppUrl();
    }

    //サーバ側のgetAppUrl()の失敗時に実行する
    function onFailure(error) {
        alert(error.message);
    }

    //サーバ側のgetAppUrl()の成功時に実行する
    function createUrl(url, screenName) {
        window.top.location.href = url + "?page=" + screenName;
    }

</script>

</html>
